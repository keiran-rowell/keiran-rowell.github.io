<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v9.2.1 <https://hydejack.com/>
-->







<head>
  






  
    
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Hartree‚ÄìFock in Rust, Julia, and Python | Keiran Rowell</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Hartree‚ÄìFock in Rust, Julia, and Python" />
<meta name="author" content="Keiran Rowell" />
<meta property="og:locale" content="en" />
<meta name="description" content="üß™ Try it yourself: Interactive demos available‚Üí Run the H2 Hartree-Fock calculations from this post directly in your browser." />
<meta property="og:description" content="üß™ Try it yourself: Interactive demos available‚Üí Run the H2 Hartree-Fock calculations from this post directly in your browser." />
<link rel="canonical" href="http://localhost:4000/code/2026-12-12-HF-in-rust-julia-python/" />
<meta property="og:url" content="http://localhost:4000/code/2026-12-12-HF-in-rust-julia-python/" />
<meta property="og:site_name" content="Keiran Rowell" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2026-12-12T00:00:00+11:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Hartree‚ÄìFock in Rust, Julia, and Python" />
<meta name="google-site-verification" content="eVRBCHg11T3gZnDg29j0bZI_jEGJECQshA49YXky_ns" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Keiran Rowell"},"dateModified":"2026-12-12T00:00:00+11:00","datePublished":"2026-12-12T00:00:00+11:00","description":"üß™ Try it yourself: Interactive demos available‚Üí Run the H2 Hartree-Fock calculations from this post directly in your browser.","headline":"Hartree‚ÄìFock in Rust, Julia, and Python","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/code/2026-12-12-HF-in-rust-julia-python/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/img/rowell_avatar.png"},"name":"Keiran Rowell"},"url":"http://localhost:4000/code/2026-12-12-HF-in-rust-julia-python/"}</script>
<!-- End Jekyll SEO tag -->


  

  
    <meta name="keywords" content="Computational chemistry,Scientific Computing,Chemistry,History of Science">
  



  <meta name="color-scheme" content="dark light">



  <meta name="theme-color" content="rgb(8,46,57)">


<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta http-equiv="x-ua-compatible" content="ie=edge">

<meta name="mobile-web-app-capable" content="yes">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Keiran Rowell">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<meta name="application-name" content="Keiran Rowell">

<meta name="generator" content="Hydejack v9.2.1" />


<link rel="alternate" href="http://localhost:4000/code/2026-12-12-HF-in-rust-julia-python/" hreflang="en">

<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Keiran Rowell" />


<link rel="shortcut icon"    href="/assets/icons/favicon.ico">
<link rel="apple-touch-icon" href="/assets/icons/icon-192x192.png">

<link rel="manifest" href="/assets/site.webmanifest">

<link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://fonts.gstatic.com">



<link rel="preload" href="/assets/img/swipe.svg" as="image" id="_hrefSwipeSVG">






<script>((r,a)=>{function d(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}r.loadJS=function(e,t){var n=a.createElement("script"),e=(n.src=e,t&&d(n,"load",t,{once:!0}),a.scripts[0]);return e.parentNode.insertBefore(n,e),n},r._loaded=!1,r.loadJSDeferred=function(e,t){var n=a.createElement("script");function o(){r._loaded=!0,t&&d(n,"load",t,{once:!0});var e=a.scripts[0];e.parentNode.insertBefore(n,e)}return n.src=e,r._loaded?o():d(r,"load",o,{once:!0}),n},r.setRel=r.setRelStylesheet=function(e){d(a.getElementById(e),"load",function(){this.rel="stylesheet"},{once:!0})}})(window,document);
!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);
!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);
!function(w) {
  w._baseURL = '/';
  w._publicPath = '/assets/js/';
  w._noPushState = false;
  w._noDrawer = false;
  w._noNavbar = false;
  w._noToc = false;
  w._noSearch = false;
  w._search = {
    DATA_URL: '/assets/sitedata.json?no-cache',
    STORAGE_KEY: 'mini-search/',
    INDEX_KEY: 'index--2026-01-14T18:34:50+11:00',
  };
  w._clapButton = true;
}(window);</script>


<script async src="/assets/bower_components/MathJax/es5/tex-mml-chtml.js" id="_MathJax"></script>


<!--[if gt IE 8]><!---->

  




<link rel="stylesheet" href="/assets/css/hydejack-9.2.1.css" id="_stylePreload">
<link rel="stylesheet" href="/assets/icomoon/style.css" id="_iconsPreload">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans:400,400i,700,700i&display=swap" id="_fontsPreload">



  <style id="_pageStyle">

html{--accent-color: rgb(79,177,186);--accent-color-faded: rgba(79,177,186,0.5);--accent-color-highlight: rgba(79,177,186,0.1);--accent-color-darkened: #409ba3;--theme-color: rgb(8,46,57);--dark-mode-body-bg: #282f31;--dark-mode-border-color: #343c3f}

</style>


<!--<![endif]-->


<link rel="stylesheet" href="/assets/css/custom.css">

<!--
Code used for embedding Gumroad on the Hydejack Site. 
Left here for reference, feel free to delete.
-->
<link rel="dns-prefetch" href="https://assets.gumroad.com">
<script type="module">
  let p;
  const promisify = f => x => new Promise(r => f(x).addEventListener('load', r));
  const loadJS = promisify(window.loadJS);
  document.querySelector('hy-push-state').addEventListener('load', () => {
    const io = new IntersectionObserver(async (entries) => {
      if (entries.some(x => x.isIntersecting)) {
        p = p || loadJS('https://gumroad.com/js/gumroad-embed.js');
        await p;
        if (!window.GumroadEmbed) {
          await new Promise(function check1(res) {
            if ('createGumroadEmbed' in window) res(window.createGumroadEmbed());
            else setTimeout(() => check1(res), 200);
          });
        }
        await new Promise(function check2(res) {
          if ('GumroadEmbed' in window) res(GumroadEmbed.reload());
          else setTimeout(() => check2(res), 200);
        });
      }
    }, { rootMargin: '1440px' });
    document.querySelectorAll('.gumroad-product-embed').forEach(el => io.observe(el));
  });
</script>
<script type="module">
  let p;
  const promisify = f => x => new Promise(r => f(x).addEventListener('load', r));
  const loadJS = promisify(window.loadJS);
  document.querySelector('hy-push-state').addEventListener('load', () => {
    const io = new IntersectionObserver(async (entries) => {
      if (entries.some(x => x.isIntersecting)) {
        p = p || loadJS('https://gumroad.com/js/gumroad.js');
        await p;
        if (!window.GumroadOverlay) {
          await new Promise(function check(res) {
            if ('createGumroadOverlay' in window) res(window.createGumroadOverlay());
            else setTimeout(() => check(res), 200);
          });
        }
      }
    }, { rootMargin: '300px' });
    document.querySelectorAll('.gumroad-button').forEach(el => io.observe(el));
  });
</script>


</head>

<body class="no-break-layout">
  
<script>
  window._sunrise = 6;
  window._sunset =  18;
  ((e,s)=>{var d="light-mode",a="dark-mode",o=(new Date).getHours();"matchMedia"in e&&e.matchMedia("(prefers-color-scheme)")||(e=(o=o<=e._sunrise||o>=e._sunset?a:d)==a?d:a,s.body.classList.add(o),s.body.classList.remove(e))})(window,document);

</script>



<hy-push-state
  id="_pushState"
  replace-selector="#_main"
  link-selector="a[href]:not([href^='/assets/']):not(.external):not(.no-push-state)"
  script-selector="script"
  duration="500"
  hashchange
>
  
  
  <div id="_navbar" class="navbar fixed-top">
  <div class="content">
    <span class="sr-only">Jump to:</span>
    <div class="nav-btn-bar">
      <a id="_menu" class="nav-btn no-hover" href="#_drawer--opened">
        <span class="sr-only">Navigation</span>
        <span class="icon-menu"></span>
      </a>
      <div class="nav-span"></div>
    </div>
  </div>
</div>
<hr class="sr-only" hidden />

  <main
  id="_main"
  class="content layout-post"
  role="main"
>
  <nav id="breadcrumbs" class="screen-only"><ul>
  
  
    <li><a href="/">home</a></li>
    
      <li>
        
          <span>/</span>
          
          
          <a href="/code/">code</a>
        
      </li>
    
      <li>
        
          <span>/</span>
          <span>2026-12-12-HF-in-rust-julia-python</span>
        
      </li>
    
  
</ul></nav>
  










<article id="post-code-HF-in-rust-julia-python" class="page post mb6" role="article">
  <header>
    <h1 class="post-title flip-project-title">
      
        Hartree‚ÄìFock in Rust, Julia, and Python
      
    </h1>

    <div class="post-date">
      
      <span class="ellipsis mr1">
        <time datetime="2026-12-12T00:00:00+11:00">12 Dec 2026</time> in <span>Code</span> on <span>Hartree-fock</span>, <span>Python</span>, <span>Julia</span>, <span>Rust</span>, <span>Code</span>, <span>Tutorial</span>, <span>Quantum-chemistry</span>
      </span>
      
        
      
    </div>

    
    

    



  <div class="hr pb0"></div>


  </header>

  
    <blockquote>
  <p>üß™ <strong>Try it yourself</strong>: <a href="/interactive/2026-12-12-HF-interactive/">Interactive demos available‚Üí</a></p>

  <p>Run the H<sub>2</sub> Hartree-Fock calculations from this post directly in your browser.</p>
</blockquote>

<hr />

<p><a href="https://youtu.be/tas0O586t80?si=H2HnFcVoS4tNqKB0">Program in C</a> they said. It‚Äôs good for you they said. <a href="https://youtu.be/hE7l6Adoiiw?si=Ourgha7DTfRy_Cer">And it is!</a>
That is until you step outside the bounds of an array. Or dereference the wrong pointer to an array of pointers. Or, heaven forbid in this chatty age, want to do text processing.
C is <em>fast</em>, it allocates memory like machine code. But it‚Äôs not the only game in town, and <a href="https://www.i-programmer.info/news/98-languages/15506-rust-fast-and-safe.html">not always the fastest</a>. 
C++ gives you a lot of powerful language features. But I don‚Äôt write in it, I never took enterprise software engineering and I like to keep digital shotguns well away from my feet.</p>

<blockquote>
  <p>‚ÄúC makes it easy to shoot yourself in the foot; C++ makes it harder, but when you do it blows your whole leg off‚Äù.</p>
</blockquote>

<p>‚Äî <a href="https://www.stroustrup.com/quotes.html">Bjarne Stroustrup</a>, developer of the C++ programming language</p>

<p>So let‚Äôs reimplement the fundamental orbital energy optimiser, the basis for all <a href="/guide/2023-04-12-compchem-methods-basics/">electronic structure theory methods</a>: Hartree‚ÄìFock.  <span style="color:#A9A9A9">(With deep debt to <a href="https://quaccs.wordpress.com/">QUACCS</a>)</span></p>

<p>In with the new <span style="color:#A9A9A9">(apologies Formula Translation maintainence work)</span>; so for pedagogical/andragogical reasons, and to learn a couple of new languages, let‚Äôs write the same algo in three languages:</p>

<ul>
  <li>üêç <code class="language-plaintext highlighter-rouge">Python</code>: It‚Äôs Python! It‚Äôs everywhere. It‚Äôs <em>readable</em>. It‚Äôs not so bad as you would think because core Numerical Python is implemented in highly optimised C anyway.</li>
  <li>üî¥üü¢üü£ <code class="language-plaintext highlighter-rouge">Julia</code>: ‚Äú<a href="https://discourse.julialang.org/t/elevator-pitch/29457/8"><em>as flexible as Python, as numerical as Matlab, as fast as Fortran, and as deep as Lisp.</em></a>‚Äù. Designed <em>for</em> scientific computing. Well, what‚Äôs not to like? It‚Äôs REPL prompt is super nice, it‚Äôs package manager doesn‚Äôt make me prematurely age like Python does in my day job. And Just-In-Time compilation is <em>incredibly smart</em>. <span style="color:#A9A9A9">(I secretly think this is why observables are indeterminate until measured, but today we‚Äôre strictly <a href="https://hsm.stackexchange.com/questions/3615/who-was-the-first-to-say-shut-up-and-calculate">‚ÄúShut up and calculate‚Äù</a>)</span></li>
  <li>ü¶Ä <code class="language-plaintext highlighter-rouge">Rust</code>: It‚Äôs all the rage, faster than C, and very nicely gives you a talking to when it can see mistakes in the future. However, it‚Äôs designed for deep systems programming. Quite likely overkill, but might give performance advantages and can be hosted on a site with WebAssembly.</li>
</ul>

<p>With <a href="https://rust-lang.org/what/wasm/">WebAssembly</a> and <a href="https://plutojl.org/">Pluto notebooks</a> we can do quantum chemistry in our browser. Let‚Äôs goooo‚Äî</p>

<hr />

<p>The Hartree‚ÄìFock algorithm is the computational kernel for more accurate <a href="/guide/2023-04-12-compchem-methods-basics/">electronic structure wavefunction methods</a>, where electron behaviour is improved by addition of either ‚Äòdynamic‚Äô electron correlation (mutual repulsion during motion) and ‚Äòstatic‚Äô correlation (fun stuff where a single arrangement of reference electron orbitals are insufficient). First we need to get a reasonable set of combined atomic orbitals for the resting state of a molecule. I‚Äôm using ‚Äúpre-baked‚Äù basis-sets as really I want to focus on the algorithm (Roothaan‚ÄìHall eigenvalue finding) and coding it up.</p>

<p>So, we‚Äôre starting with a set of atomic orbitals (\(\chi_{n}\)) (here, the minimal viable ones, the basis-set). We combine them to get some set of molecular orbitals (\(\phi_{i} = \sum\limits_{n}C_{ni}\chi_{n}\)) (MOs).</p>

<p>If we take these electrons and capture their properties as spin‚Äì\(\frac{1}{2}\) particles‚Äîkinetic energy, attraction to nuclei, electron‚Äìelectron repulsions, change of sign upon indistinguishable particle exchange (Fermi stats)‚Äî we get the Fock operator \(\hat{F}\) to work with. Really, the Fock operator is related to the overlap of orbital basis set vectors (\({S}\)), and we can use an algorithm to optimise the co-efficients (\({C}\)) of these orbitals to lower the orbital energies (\(\epsilon\))</p>

<p>So we have the Roothan‚ÄìHall matrix optimisation problem of finding the co-efficients that lowers the molecular orbital energies, which is guaranteed to be the closest to ground-state reality for HF (the Variational Principle).</p>

\[\mathbf{FC} =  \mathbf{SC}\epsilon\]

<p>Right, enough notation. Let‚Äôs set up an engine that finds the energy eigenvalues (\(\epsilon\)) given some input orbitals, and then uses and optimisation algorithm to feed the output co-efficients back in to iteratively refind until converge. Yielding a set of one-electron orbitals solved in ‚Äúself-consistent field‚Äù with respect to the other electrons. Time to code.</p>

<blockquote>
  <p>Code snippets will be as quotes. Blocks will be syntax highlighted. Some things will be interactive through web magic. Those are in a later <a href="">post</a></p>
</blockquote>

<p>We‚Äôre going to do a toy version of restricted Hartree‚ÄìFock for understanding purposes.</p>

<p>Basically saying <code class="language-plaintext highlighter-rouge">Hello World!</code> to H<sub>2</sub>.</p>

<hr />

<h1 id="basis-sets">Basis Sets</h1>

<hr />
<h2 id="python-">Python üêç</h2>

<p>Using <a href="https://github.com/bennybp">@bennyp</a> and <a href="https://github.com/susilehtola">@susilehtola</a>‚Äôs <a href="https://molssi-bse.github.io/basis_set_exchange/usage.html#"><code class="language-plaintext highlighter-rouge">basis_set_exchange</code></a> library provied for MolSSI (the Molecular Sciences Software Institute).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pip</span> <span class="n">install</span> <span class="n">basis_set_exchange</span>

<span class="kn">import</span> <span class="nn">basis_set_exchange</span>
<span class="n">sto3g_orca_fmt</span> <span class="o">=</span>  <span class="n">basis_set_exchange</span><span class="p">.</span><span class="n">get_basis</span><span class="p">(</span><span class="s">'STO-3G'</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">'ORCA'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">sto3g_orca_fmt</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$DATA

HYDROGEN
S   3
1         0.3425250914E+01       0.1543289673E+00
2         0.6239137298E+00       0.5353281423E+00
3         0.1688554040E+00       0.4446345422E+00
</code></pre></div></div>
<p>Looking good!</p>

<hr />

<h2 id="julia-">Julia üî¥üü¢üü£</h2>

<p>Using <a href="https://github.com/Leticia-maria">@Leticia-maria</a>‚Äôs <a href="https://github.com/HartreeFoca/BasisSets.jl">BasisSets.jl</a> Basis Set Exchange parser.</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="n">Pkg</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="x">(</span><span class="s">"BasisSets"</span><span class="x">)</span>
<span class="k">using</span> <span class="n">BasisSets</span>
</code></pre></div></div>

<p>Create a <code class="language-plaintext highlighter-rouge">H2.xyz</code> with 0.74 √Ö / 1.4 Bohr seperation on the Z-axis.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2

H 0.000000 0.000000 0.000000
H 0.000000 0.000000 1.400000
</code></pre></div></div>

<p>Check a minimal H<sub>2</sub> minimal basis set.</p>

<p><span style="color:#A9A9A9">The README omits the intermediate molecule() function you can find by running names(BasisSets)</span></p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">h2_mol</span> <span class="o">=</span> <span class="n">molecule</span><span class="x">(</span><span class="s">"./H2.xyz"</span><span class="x">)</span>
<span class="n">h2_sto3g</span> <span class="o">=</span> <span class="n">parsebasis</span><span class="x">(</span><span class="n">h2_mol</span><span class="x">,</span> <span class="s">"STO-3g"</span><span class="x">)</span>
</code></pre></div></div>

<p>Inspect with <code class="language-plaintext highlighter-rouge">dump(h2_sto3g)</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Array{BasisSets.GaussianBasisSet}((2,))
  1: BasisSets.GaussianBasisSet
    R: Array{Float64}((1, 3)) [0.0 0.0 0.0]
    Œ±: Array{Float64}((1, 3)) [3.42525091 0.62391373 0.1688554]
    d: Array{Float64}((1, 3)) [0.15432897 0.53532814 0.44463454]
    N: Array{Float64}((1, 3)) [1.794441832218435 0.5003264923314032 0.18773545851092535]
    size: Int64 3
    ‚Ñì: Int64 0
    m: Int64 0
    n: Int64 0
  2: BasisSets.GaussianBasisSet
    R: Array{Float64}((1, 3)) [0.0 0.0 1.4]
    Œ±: Array{Float64}((1, 3)) [3.42525091 0.62391373 0.1688554]
    d: Array{Float64}((1, 3)) [0.15432897 0.53532814 0.44463454]
    N: Array{Float64}((1, 3)) [1.794441832218435 0.5003264923314032 0.18773545851092535]
    size: Int64 3
    ‚Ñì: Int64 0
    m: Int64 0
    n: Int64 0
</code></pre></div></div>
<p>With symbols, neat!</p>

<hr />

<h2 id="rust-">Rust ü¶Ä</h2>

<p>Right, I wore my trousers rolled and scuttled through the conceptual waves of <a href="https://rustlings.rust-lang.org/">Rustlings</a>. Time to put skimming into practice and build something with the borrow checker reminding me of any memory allocation or variable error.</p>

<p>Yoinking <a href="https://github.com/iggedi-ig-ig">@iggedi-ig-ig</a>‚Äôs <a href="https://github.com/iggedi-ig-ig/fock-rs/tree/master/basis_set">basis set parser</a> since I want to leverage the <a href="https://www.basissetexchange.org/">Basis Set Exchange</a>.</p>

<p>Start project with <code class="language-plaintext highlighter-rouge">cargo new h2_hf_rust</code></p>

<p>Download the <code class="language-plaintext highlighter-rouge">STO-3G</code> basis set file and save it within the project.</p>

<p><code class="language-plaintext highlighter-rouge">wget -O sto-3g-h.json "https://www.basissetexchange.org/api/basis/sto-3g/format/json/?version=1&amp;elements=1"</code></p>

<p>Add the basis set package to the <code class="language-plaintext highlighter-rouge">Cargo.toml</code> dependency listing, and the json parsing library</p>
<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[dependencies]</span>
<span class="nn">basis_set</span> <span class="o">=</span> <span class="p">{</span> <span class="py">git</span> <span class="p">=</span> <span class="s">"https://github.com/iggedi-ig-ig/fock-rs"</span><span class="p">,</span> <span class="py">package</span> <span class="p">=</span> <span class="s">"basis_set"</span> <span class="p">}</span>
<span class="py">serde_json</span> <span class="p">=</span> <span class="s">"1.0"</span>
</code></pre></div></div>

<p>Test out BasisSet library function in <code class="language-plaintext highlighter-rouge">src/main.rs</code></p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">basis_set</span><span class="p">::</span><span class="n">BasisSet</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">fs</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">json</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">read_to_string</span><span class="p">(</span><span class="s">"sto-3g-h.json"</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
    <span class="k">let</span> <span class="n">basis</span><span class="p">:</span> <span class="n">BasisSet</span> <span class="o">=</span> <span class="nn">serde_json</span><span class="p">::</span><span class="nf">from_str</span><span class="p">(</span><span class="o">&amp;</span><span class="n">json</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>

    <span class="nd">println!</span><span class="p">(</span><span class="s">"Loaded basis set: {} ({})"</span><span class="p">,</span> <span class="n">basis</span><span class="py">.name</span><span class="p">,</span> <span class="n">basis</span><span class="py">.description</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Full details:</span><span class="se">\n</span><span class="s">{:#?}"</span><span class="p">,</span> <span class="n">basis</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div>

<p>And now run the project with <code class="language-plaintext highlighter-rouge">cargo run</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Full basis set details:
BasisSet {
...
                    exponents: [
                        "0.3425250914E+01",
                        "0.6239137298E+00",
                        "0.1688554040E+00",
                    ],
                    coefficients: [
                        [
                            "0.1543289673E+00",
                            "0.5353281423E+00",
                            "0.4446345422E+00",
...
    family: SlaterType,
    description: "STO-3G Minimal Basis (3 functions/AO)",
    role: "orbital",
    name: "STO-3G",
}
</code></pre></div></div>
<p>We have hydrogen‚Äôs STO-3G basis!</p>

<hr />

<h1 id="hartreefock">Hartree‚ÄìFock</h1>

<hr />

<h2 id="the-overlap-integral-s">The overlap integral (S)</h2>

<p>So the core of part the algorithm is computing the <strong>overlap matrix</strong> \(\mathbf{S}\) between two basis functions in space.</p>

\[S_{ij} = \langle \chi_i | \chi_j \rangle = \int \chi_i^*(\mathbf{r}) \chi_j(\mathbf{r}) \, d\mathbf{r}\]

<p>We‚Äôll write a function that computes the overlap of two basis functions, working on the primitives with their exponents (Œ±, Œ≤).</p>

<p>üêç
<code class="language-plaintext highlighter-rouge">def compute_S_primitive(alpha, beta, R_A, R_B)</code></p>

<p>üî¥üü¢üü£
<code class="language-plaintext highlighter-rouge">function compute_S_primitive(Œ±::Float64, Œ≤::Float64, R_A::Vector{Float64}, R_B::Vector{Float64})</code></p>

<p>ü¶Ä
<code class="language-plaintext highlighter-rouge">let S = overlap_integral(&amp;basis1, &amp;basis2);</code></p>

<p>We have two hydrogen atoms with a minimal basis, so we should get a 2x2 matrix to inspect.</p>

\[\mathbf{S} = \begin{bmatrix}
\langle \chi_1 | \chi_1 \rangle &amp; \langle \chi_1 | \chi_2 \rangle \\
\langle \chi_2 | \chi_1 \rangle &amp; \langle \chi_2 | \chi_2 \rangle
\end{bmatrix}\]

<p>A basis function completely overlaps with itself, so we get one on the diagonals, and the overlap values (\(S_{ij}\)) on the off-diagonals depend on your basis set and molecular geometry.</p>

\[\mathbf{S} = \begin{bmatrix}
1 &amp; S_{12} \\
S_{21} &amp; 1
\end{bmatrix}\]

<p>The self-consistent field cycles will optimise the co-efficients for how your orbitals combine within this overlap.</p>

<p>With two s-orbital Gaussian <em>primitives</em> the overlap integral is:</p>

\[S = \left(\frac{\pi}{\alpha + \beta}\right)^{3/2} \exp\left(-\frac{\alpha\beta}{\alpha+\beta}|\mathbf{R}_A - \mathbf{R}_B|^2\right)\]

<p>üêç</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">S_prim</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">beta</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">((</span><span class="n">R_A</span> <span class="o">-</span> <span class="n">R_B</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></div>
<p>üî¥üü¢üü£ <span style="color:#A9A9A9">(the <code class="language-plaintext highlighter-rouge">.</code> operator means apply to each <em>element</em> in an array independently)</span></p>
<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">S_prim</span> <span class="o">=</span> <span class="x">(</span><span class="nb">œÄ</span> <span class="o">/</span> <span class="x">(</span><span class="n">Œ±</span> <span class="o">+</span> <span class="n">Œ≤</span><span class="x">))</span><span class="o">^</span><span class="x">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="x">)</span> <span class="o">*</span> <span class="n">exp</span><span class="x">(</span><span class="o">-</span><span class="x">(</span><span class="n">Œ±</span> <span class="o">*</span> <span class="n">Œ≤</span> <span class="o">/</span> <span class="x">(</span><span class="n">Œ±</span> <span class="o">+</span> <span class="n">Œ≤</span><span class="x">))</span> <span class="o">*</span> <span class="n">sum</span><span class="x">((</span><span class="n">R_A</span> <span class="o">.-</span> <span class="n">R_B</span><span class="x">)</span><span class="o">.^</span><span class="mi">2</span><span class="x">))</span>
</code></pre></div></div>
<p>ü¶Ä</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">dist_sq</span><span class="p">:</span> <span class="nb">f64</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">3</span><span class="p">)</span> <span class="c1">//summing over X,Y,Z indices</span>
    <span class="nf">.map</span><span class="p">(|</span><span class="n">i</span><span class="p">|</span> <span class="p">(</span><span class="n">r_a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">r_b</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="nf">.powi</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="nf">.sum</span><span class="p">();</span>
<span class="k">let</span> <span class="n">S_prim</span> <span class="o">=</span> <span class="p">(</span><span class="nn">std</span><span class="p">::</span><span class="nn">f64</span><span class="p">::</span><span class="nn">consts</span><span class="p">::</span><span class="n">PI</span> <span class="o">/</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">beta</span><span class="p">))</span><span class="nf">.powf</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span> 
    <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">dist_sq</span><span class="p">)</span><span class="nf">.exp</span><span class="p">();</span>
</code></pre></div></div>

<p>The actual <code class="language-plaintext highlighter-rouge">overlap_integral</code> function when working with a real contracted basis set will involved summing the primitives in the basis set, weighted by contraction co-efficients and normalised.</p>

<hr />

<h2 id="operator-matrices-setup">Operator matrices setup</h2>

<h3 id="denisty-matrix-d">Denisty matrix (D)</h3>
<p>To kickstart our engine we need an intial electron density matrix (\(\mathbf{D}\)). For a toy system it‚Äôs actually okay to start with zero density everywhere (or the identity matrix).</p>

<p>Though for any real molecular system choice of a good guess is important for convergence. For difficult to converge cases, feeding in the results of a simpler model chemistry will help start need a convergent minimum.</p>

<p>üêç</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_basis</span><span class="p">,</span> <span class="n">n_basis</span><span class="p">))</span>
</code></pre></div></div>
<p>üî¥üü¢üü£</p>
<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">D</span> <span class="o">=</span> <span class="n">zeros</span><span class="x">(</span><span class="n">n_basis</span><span class="x">,</span> <span class="n">n_basis</span><span class="x">)</span>
</code></pre></div></div>
<p>ü¶Ä</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">TODO</span><span class="p">:</span> <span class="n">UPDATE</span>
<span class="k">let</span> <span class="k">mut</span> <span class="n">d</span> <span class="o">=</span> <span class="nn">Array2</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">f64</span><span class="o">&gt;</span><span class="p">::</span><span class="nf">zeros</span><span class="p">((</span><span class="n">n_basis</span><span class="p">,</span> <span class="n">n_basis</span><span class="p">));</span>
</code></pre></div></div>

<h3 id="fock-operator-f">Fock operator (F)</h3>

<p>For teaching purposes we‚Äôre going to skip the electron-electron repulsion integrals (ERIs) that are the bulk of the computational cost and code complexity.
In this way our <em>toy</em> Fock matrix (\(\mathbf{F}\)) is just the core Hamiltonian (\(\mathbf{F}\)‚Äî the total energy of forces acting on our one-electron core). This is really just our electrons‚Äô kinetic energies (\(\mathbf{T}\)) and their attractive potential energy to the nuceli (\(\mathbf{V}^{\text{nuc}}\))</p>

\[\mathbf{F} = \mathbf{H}^{\text{core}} = \mathbf{T} + \mathbf{V}^{\text{nuc}}\]

<h3 id="kinetic-energy-operator-t">Kinetic energy operator (T)</h3>

<p>The electron kinetic energy is the momentum taken in all directions (\(\nabla\)):
\(\hat{T} = -\frac{1}{2}\nabla^2\)</p>

<p>When evaluating between two basis functions:
\(T_{\mu\nu} = \left\langle \chi_\mu \left| -\frac{1}{2}\nabla^2 \right| \chi_\nu \right\rangle\)</p>

<p>Taking the result from Szabo &amp; Ostlund <em>‚ÄúModern Quantum Chemistry‚Äù</em> Appendix A as I‚Äôm not a physicist. Note the relationship to \(S\):</p>

\[T = \alpha\beta\left[\frac{3}{\alpha+\beta} - \frac{2(\alpha\beta)}{(\alpha+\beta)^2}|\mathbf{R}_A - \mathbf{R}_B|^2\right] S\]

<p>üêç</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">reduced_exp</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">beta</span><span class="p">)</span>
<span class="n">T_prim</span> <span class="o">=</span> <span class="n">reduced_exp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">reduced_exp</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">((</span><span class="n">R_A</span> <span class="o">-</span> <span class="n">R_B</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">S_prim</span>
</code></pre></div></div>
<p>üî¥üü¢üü£</p>
<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">reduced_exp</span> <span class="o">=</span> <span class="n">Œ±</span> <span class="o">*</span> <span class="n">Œ≤</span> <span class="o">/</span> <span class="x">(</span><span class="n">Œ±</span> <span class="o">+</span> <span class="n">Œ≤</span><span class="x">)</span>
<span class="n">T_prim</span> <span class="o">=</span> <span class="n">reduced_exp</span> <span class="o">*</span> <span class="x">(</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">reduced_exp</span> <span class="o">*</span> <span class="n">sum</span><span class="x">((</span><span class="n">R_A</span> <span class="o">.-</span> <span class="n">R_B</span><span class="x">)</span><span class="o">.^</span><span class="mi">2</span><span class="x">))</span> <span class="o">*</span> <span class="n">S_prim</span>
</code></pre></div></div>
<p>ü¶Ä</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>let reduced_exp = alpha * beta / (alpha + beta);
let T_prim = reduced_exp * (3.0 - 2.0 * reduced_exp * dist_sq) * S_prim;
</code></pre></div></div>

<h3 id="nuclear-attraction-potential-v">Nuclear attraction potential (V)</h3>
<p>We invoke the Born-Oppenheimer approximation that electron motion occurs on much faster timescale than nuclear re-arrangement (can also think of this in terms of different decoupled energy scales). So the nuclei are effectively <em>fixed</em> in place.</p>

\[\hat{V}^{\text{nuc}}_A = -\frac{Z_A}{|\mathbf{r} - \mathbf{R}_A|}\]

\[V^{\text{nuc}}_{\mu\nu} = -\left\langle \chi_\mu \left| \frac{1}{|\mathbf{r} - \mathbf{R}_1|} \right| \chi_\nu \right\rangle - \left\langle \chi_\mu \left| \frac{1}{|\mathbf{r} - \mathbf{R}_2|} \right| \chi_\nu \right\rangle\]

<p>The nuclear attraction integrals involve special functions that are beyond our scope here. They‚Äôre implement in <code class="language-plaintext highlighter-rouge">integrals.[py/jl/rs]</code> since 1/R wasn‚Äôt showing good behaviour even for a toy system. I‚Äôm just going to mention the function header for this guide, those curious can refer to the code generated from a reference.</p>

<p>üêç</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">compute_V_nuc_primitive</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">R_A</span><span class="p">,</span> <span class="n">R_B</span><span class="p">,</span> <span class="n">R_nuc</span><span class="p">):</span>
</code></pre></div></div>
<p>üî¥üü¢üü£</p>
<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span><span class="nf"> compute_V_nuc_primitive</span><span class="x">(</span><span class="n">Œ±</span><span class="o">::</span><span class="kt">Float64</span><span class="x">,</span> <span class="n">Œ≤</span><span class="o">::</span><span class="kt">Float64</span><span class="x">,</span> <span class="n">R_A</span><span class="o">::</span><span class="kt">Vector</span><span class="x">{</span><span class="kt">Float64</span><span class="x">},</span> <span class="n">R_B</span><span class="o">::</span><span class="kt">Vector</span><span class="x">{</span><span class="kt">Float64</span><span class="x">},</span> <span class="n">R_nuc</span><span class="o">::</span><span class="kt">Vector</span><span class="x">{</span><span class="kt">Float64</span><span class="x">})</span> 
</code></pre></div></div>
<p>ü¶Ä</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TBD
</code></pre></div></div>

<h3 id="electron-repulsion-integrals-eris">Electron Repulsion Integrals (ERIs)</h3>

<p>The most demanding part of the Hartree‚ÄìFock calculation, both computational and mathematically. I‚Äôve farmed them out to <code class="language-plaintext highlighter-rouge">integrals.py</code> to not break the logic flow of SCF. This is where I‚Äôve put the overlap and kinetic energy integrals as well.</p>

<p>The electron-electron repulsion matrix (\(\mathbf{G}\)) captures both the Coloumbic repulsions between negative charges (\(\mathbf{J}\)) and the quantum effect of change of wavefunction sign upon exchange of two particles (\(\mathbf{K}\))</p>

\[\mathbf{G}[\mathbf{D}] = \mathbf{J}[\mathbf{D}] - \mathbf{K}[\mathbf{D}]\]

<p>Refer to <code class="language-plaintext highlighter-rouge">integrals.[py/jl/rs]</code>, which I‚Äôve just generated from a reference, if you want more details.</p>

<p>üêç</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">G</span> <span class="o">=</span> <span class="n">build_G_matrix</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">ERIs</span><span class="p">)</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">T</span> <span class="o">+</span> <span class="n">V_nuc</span> <span class="o">+</span> <span class="n">G</span>
</code></pre></div></div>
<p>üî¥üü¢üü£</p>
<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">G</span> <span class="o">=</span> <span class="n">build_G_matrix</span><span class="x">(</span><span class="n">D</span><span class="x">,</span> <span class="n">ERIs</span><span class="x">)</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">T</span> <span class="o">+</span> <span class="n">V_nuc</span> <span class="o">+</span> <span class="n">G</span>
</code></pre></div></div>
<h2 id="the-self-consistent-field-scf-loop">The self-consistent field (SCF) loop</h2>

<p>Recall this is an iterative eigenvalue finding problem
\(\mathbf{FC} = \epsilon\mathbf{SC}\)</p>

<p>To that that we need to do some orthogonalisation
\(\mathbf{X} = \mathbf{S}^{-\frac{1}{2}}\)</p>

<p>Use the transpose of the orthogonalisation matrix (\(\mathbf{X}^{T}\)) to transform the Fock operator into the new basis
\(\mathbf{F}' = \mathbf{X}^{T}\mathbf{F}\mathbf{X}\)</p>

<p>Solve for the eignevalues of the co-efficient matrix
\(\mathbf{F}'\mathbf{C}' = \mathbf{C}'\epsilon\)</p>

<p>Update the new co-efficient matrix into original basis
\(\mathbf{C} = \mathbf{X}\mathbf{C}'\)</p>

<p>üêç</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s_eigvals</span><span class="p">,</span> <span class="n">s_eigvecs</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">s_eigvecs</span> <span class="o">@</span> <span class="n">np</span><span class="p">.</span><span class="n">diag</span><span class="p">(</span><span class="n">s_eigvals</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">))</span> <span class="o">@</span> <span class="n">s_eigvecs</span><span class="p">.</span><span class="n">T</span>

<span class="n">F_prime</span> <span class="o">=</span> <span class="n">X</span><span class="p">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">F</span> <span class="o">@</span> <span class="n">X</span>

<span class="n">epsilon</span><span class="p">,</span> <span class="n">C_prime</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">F_prime</span><span class="p">)</span>

<span class="n">C</span> <span class="o">=</span> <span class="n">X</span> <span class="o">@</span> <span class="n">C_prime</span>
</code></pre></div></div>
<p>üî¥üü¢üü£</p>
<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="n">LinearAlgebra</span>

<span class="n">s_eigvals</span><span class="x">,</span> <span class="n">s_eigvecs</span> <span class="o">=</span> <span class="n">eigen</span><span class="x">(</span><span class="kt">Symmetric</span><span class="x">(</span><span class="n">S</span><span class="x">))</span>
<span class="n">clean_eigvals</span> <span class="o">=</span> <span class="n">max</span><span class="o">.</span><span class="x">(</span><span class="n">s_eigvals</span><span class="x">,</span> <span class="mf">1e-15</span><span class="x">)</span> <span class="c"># avoid inverting numerical noise</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">s_eigvecs</span> <span class="o">*</span> <span class="kt">Diagonal</span><span class="x">(</span><span class="n">clean_eigvals</span> <span class="o">.^</span> <span class="x">(</span><span class="o">-</span><span class="mf">0.5</span><span class="x">))</span> <span class="o">*</span> <span class="n">s_eigvecs</span><span class="err">'</span>

<span class="n">F‚Ä≤</span> <span class="o">=</span> <span class="n">X</span><span class="err">'</span> <span class="o">*</span> <span class="n">F</span> <span class="o">*</span> <span class="n">X</span>
<span class="n">œµ</span><span class="x">,</span> <span class="n">C‚Ä≤</span> <span class="o">=</span> <span class="n">eigen</span><span class="x">(</span><span class="kt">Symmetric</span><span class="x">(</span><span class="n">F‚Ä≤</span><span class="x">))</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">X</span> <span class="o">*</span> <span class="n">C‚Ä≤</span>
</code></pre></div></div>
<p>ü¶Ä</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">ndarray_linalg</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

<span class="k">let</span> <span class="p">(</span><span class="n">s_eigvals</span><span class="p">,</span> <span class="n">s_eigvecs</span><span class="p">)</span> <span class="o">=</span> <span class="n">s</span><span class="nf">.eigh</span><span class="p">(</span><span class="nn">UPLO</span><span class="p">::</span><span class="n">Lower</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="k">let</span> <span class="n">s_inv_sqrt</span> <span class="o">=</span> <span class="n">s_eigvecs</span><span class="nf">.dot</span><span class="p">(</span><span class="o">&amp;</span><span class="nn">Array2</span><span class="p">::</span><span class="nf">from_diag</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s_eigvals</span><span class="nf">.mapv</span><span class="p">(|</span><span class="n">x</span><span class="p">|</span> <span class="n">x</span><span class="nf">.powf</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">))))</span><span class="nf">.dot</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s_eigvecs</span><span class="nf">.t</span><span class="p">());</span>

<span class="k">let</span> <span class="n">f_prime</span> <span class="o">=</span> <span class="n">s_inv_sqrt</span><span class="nf">.t</span><span class="p">()</span><span class="nf">.dot</span><span class="p">(</span><span class="o">&amp;</span><span class="n">f</span><span class="p">)</span><span class="nf">.dot</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s_inv_sqrt</span><span class="p">);</span>

<span class="k">let</span> <span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">c_prime</span><span class="p">)</span> <span class="o">=</span> <span class="n">f_prime</span><span class="nf">.eigh</span><span class="p">(</span><span class="nn">UPLO</span><span class="p">::</span><span class="n">Lower</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="k">let</span> <span class="n">c</span> <span class="o">=</span> <span class="n">s_inv_sqrt</span><span class="nf">.dot</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c_prime</span><span class="p">);</span>
</code></pre></div></div>

<p>Time to update the density matrix using these new co-efficients. This is H<sub>2</sub> in restricted Hartree‚ÄìFock so only one occupied orbital to deal with.</p>

\[D_{\mu\nu} = 2\sum_{i}^{\text{occ}} C_{\mu i} C_{\nu i}\]

<p>üêç</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_occ</span> <span class="o">=</span> <span class="n">num_electrons</span> <span class="o">//</span> <span class="mi">2</span> 
<span class="n">D_new</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">C</span><span class="p">[:,</span> <span class="p">:</span><span class="n">num_occ</span><span class="p">]</span> <span class="o">@</span> <span class="n">C</span><span class="p">[:,</span> <span class="p">:</span><span class="n">num_occ</span><span class="p">].</span><span class="n">T</span>
</code></pre></div></div>
<p>üî¥üü¢üü£</p>
<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_occ</span> <span class="o">=</span> <span class="n">num_electrons</span> <span class="o">√∑</span> <span class="mi">2</span> 
<span class="n">D_new</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">C</span><span class="x">[</span><span class="o">:</span><span class="x">,</span> <span class="mi">1</span><span class="o">:</span><span class="n">num_occ</span><span class="x">]</span> <span class="o">*</span> <span class="n">C</span><span class="x">[</span><span class="o">:</span><span class="x">,</span> <span class="mi">1</span><span class="o">:</span><span class="n">num_occ</span><span class="x">]</span><span class="err">'</span>
</code></pre></div></div>
<p>ü¶Ä</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">n_occ</span> <span class="o">=</span> <span class="n">n_electrons</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> 
<span class="k">let</span> <span class="n">c_occ</span> <span class="o">=</span> <span class="n">c</span><span class="nf">.slice</span><span class="p">(</span><span class="nd">s!</span><span class="p">[</span><span class="o">..</span><span class="p">,</span> <span class="mi">0</span><span class="o">..</span><span class="n">n_occ</span><span class="p">]);</span>
<span class="k">let</span> <span class="n">d_new</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">c_occ</span><span class="nf">.dot</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c_occ</span><span class="nf">.t</span><span class="p">());</span>
</code></pre></div></div>
<h3 id="energy-convergence-check">Energy convergence check</h3>

<p>We can calculate the energy from summing enetries in the Fock operator and core Hamiltonian</p>

\[E = \frac{1}{2}\text{Tr}[\mathbf{D}(\mathbf{H}^{\text{core}} + \mathbf{F})]\]

<p>Then it‚Äôs just the matter of checking that the energy hasn‚Äôt changed between each cycle, to some tolerance</p>

\[\Delta E = |E_{\text{new}} - E_{\text{old}}| &lt; \epsilon_{\text{tol}}\]

<p>üêç</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">E_new</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">trace</span><span class="p">(</span><span class="n">D_new</span> <span class="o">@</span> <span class="p">(</span><span class="n">H_core</span> <span class="o">+</span> <span class="n">F</span><span class="p">))</span>

<span class="n">delta_E</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">E_new</span> <span class="o">-</span> <span class="n">E_old</span><span class="p">)</span>
<span class="k">if</span> <span class="n">delta_E</span> <span class="o">&lt;</span> <span class="n">epsilon_tol</span><span class="p">:</span>
    <span class="n">converged</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Converged! Final energy: </span><span class="si">{</span><span class="n">E_new</span><span class="si">:</span><span class="p">.</span><span class="mi">6</span><span class="n">f</span><span class="si">}</span><span class="s"> Ha"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">E_old</span> <span class="o">=</span> <span class="n">E_new</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">D_new</span>
</code></pre></div></div>
<p>üî¥üü¢üü£</p>
<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">E_new</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">tr</span><span class="x">(</span><span class="n">D_new</span> <span class="o">*</span> <span class="x">(</span><span class="n">H_core</span> <span class="o">+</span> <span class="n">F</span><span class="x">))</span>

<span class="n">ŒîE</span> <span class="o">=</span> <span class="n">abs</span><span class="x">(</span><span class="n">E_new</span> <span class="o">-</span> <span class="n">E_old</span><span class="x">)</span>
<span class="k">if</span> <span class="n">ŒîE</span> <span class="o">&lt;</span> <span class="n">Œµ_tol</span>
    <span class="n">converged</span> <span class="o">=</span> <span class="nb">true</span>
    <span class="n">println</span><span class="x">(</span><span class="s">"Converged! Final energy: </span><span class="si">$</span><span class="s">E_new Ha"</span><span class="x">)</span>
<span class="k">else</span>
    <span class="n">E_old</span> <span class="o">=</span> <span class="n">E_new</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">D_new</span>
<span class="k">end</span>
</code></pre></div></div>
<p>ü¶Ä</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>let e_new = 0.5 * (&amp;d_new * &amp;(&amp;h_core + &amp;f)).trace().unwrap();

let delta_e = (e_new - e_old).abs();
if delta_e &lt; epsilon_tol {
    converged = true;
    println!("Converged! Final energy: {:.6} Ha", e_new);
} else {
    e_old = e_new;
    d = d_new;
}
</code></pre></div></div>

<p>We wrap the above in a loop with a maximum number of iterations and we‚Äôre ready!</p>

<hr />
<h1 id="performance-comparison">Performance comparison</h1>

<p>Obviously solving a fake H<sub>2</sub> is a terrible comparison for the code performance doing real chemistry. Nevertheless..</p>

<hr />

<h2 id="non-execution-speed-stuff">Non execution speed stuff</h2>

<h3 id="lines-of-code">Lines of code</h3>
<h3 id="ease-of-development">Ease of development</h3>
<h3 id="readability">Readability</h3>
<h3 id="any-other-pains">Any other pains</h3>

<hr />
<h1 id="creating-web-content">Creating web content</h1>
<hr />
<p>Embedded Rust with <code class="language-plaintext highlighter-rouge">wasm-pack build --target web</code> and upload as a module with a <code class="language-plaintext highlighter-rouge">.js</code> file</p>

<p>Python load a <code class="language-plaintext highlighter-rouge">pyodide.js</code>. Will be slow</p>

<p><code class="language-plaintext highlighter-rouge">Julia</code> üî¥üü¢üü£: there‚Äôs a live Pluto notebook with H<sub>2</sub> sliders <a href="https://pluto.land/n/lg6ry63f">here</a>.</p>

<p>Julia is designed to hit sweet-spot of easy to write and performance for scientific code, so muich so that there‚Äôs now a full production quality <a href="https://doi.org/10.1021/acs.jctc.0c00337">Quantum Chemistry package written in Julia</a>.</p>

<p>The sliders will be of R (maybe 0.25-1.5 A), so you can see the off-diagonal elements of S change, and the basis sets chosen from a dropdown. Then hit ‚Äòrun‚Äô and watch the SCF cycles converge.</p>

<p>Have all 2x2 S matrix elements displayed. Plot the SCF cycles</p>

<hr />

<h2 id="related-web-resources">Related web resources</h2>

<ul>
  <li>üêç <a href="/interactive/hf-python/index.html">Python version</a> - Run with Pyodide</li>
  <li>üî¥üü¢üü£ <a href="/interactive/hf-julia/index.html">Julia version</a> - Try it in your browser in a Pluto notebook</li>
  <li>ü¶Ä <a href="/interactive/hf-rust/index.html">Rust version</a> - WebAssembly performance</li>
  <li>üíª <a href="https://github.com/keiran-rowell/hartee-fock">Source Code</a> - All implementations</li>
</ul>

  
</article>



  <hr class="dingbat related mb6" />






  
     


  <aside class="about related mt4 mb4" role="complementary">
    
    

<div class="author mt4">
  

  
    


<img
  
    src="/images/Rowell_MONA_avatar_128x128.png"
  
  alt="Keiran Rowell"
  class="avatar"
  
  width="120"
  height="120"
  loading="lazy"
/>

  

  
  
  <h2  class="page-title hr-bottom">
    About
  </h2>

  <p>Keiran Rowell is a scientist living on unceded Gadigal land in Sydney, Australia.</p>


  <div class="sidebar-social">
    <span class="sr-only">Social:</span>
<ul>
  
    
      



  

  
  
  
  

  

  

  <li>
    <a href="mailto:keiran.rowell@gmail.com" title="Email" class="no-mark-external">
      <span class="icon-mail"></span>
      <span class="sr-only">Email</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://scholar.google.com/citations?user=tpcUE5IAAAAJ" title="Google Scholar" class="no-mark-external">
      <span class="icon-book"></span>
      <span class="sr-only">Google Scholar</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://github.com/keiran-rowell" title="GitHub" class="no-mark-external">
      <span class="icon-github"></span>
      <span class="sr-only">GitHub</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://mastodon.social/@keiran_rowell" title="Mastodon" class="no-mark-external">
      <span class="icon-mastodon"></span>
      <span class="sr-only">Mastodon</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://www.linkedin.com/in/keiran-rowell" title="LinkedIn" class="no-mark-external">
      <span class="icon-linkedin2"></span>
      <span class="sr-only">LinkedIn</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://www.analytical.unsw.edu.au/facilities/sbf" title="Faculty" class="no-mark-external">
      <span class="icon-library"></span>
      <span class="sr-only">Faculty</span>
    </a>
  </li>


    
  
</ul>

  </div>
</div>

  </aside>


  

  
  

  
    


  <aside class="related mb4" role="complementary">  <h2 class="hr-bottom">Related Posts</h2>  <ul class="related-posts">                  <li class="h4">  <a href="/interactive/2026-12-12-HF-interactive/" class="flip-title"><span>Interactive Hartree‚ÄìFock in your browser: NextGen Lang trifecta</span></a>  <time class="faded fine" datetime="2026-12-12T00:00:00+11:00">12 Dec 2026</time></li>                        <li class="h4">  <a href="/writing/2026-01-01-the-delian-mode/" class="flip-title"><span>The Delian Mode: anti-imperial leagues, synths, federated computing, and lost futures</span></a>  <time class="faded fine" datetime="2026-01-01T00:00:00+11:00">01 Jan 2026</time></li>                        <li class="h4">  <a href="/dyes/2025-11-05-aniline-and-the-german-chemical-industry/" class="flip-title"><span>From Muck to Mauve: the creation of modern dyes from coal tar</span></a>  <time class="faded fine" datetime="2025-11-05T00:00:00+11:00">05 Nov 2025</time></li>            </ul></aside>

  

  
  

  
    

  


  
<footer class="content" role="contentinfo">
  <hr/>
  
    <p><small class="copyright">2026 Keiran Rowell. License <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA</a>
</small></p>
  
  
    <p><small>Powered by <a class="external" href="https://hydejack.com/">Hydejack</a> v<span id="_version">9.2.1</span></small></p>
  <hr class="sr-only"/>
</footer>


</main>

  <hy-drawer
  id="_drawer"
  class=""
  side="left"
  threshold="10"
  noscroll
  
>
  <header id="_sidebar" class="sidebar" role="banner">
    




<div class="sidebar-bg sidebar-overlay" style="background-color:rgb(8,46,57);background-image:url(/assets/img/n_to_pi_star.png)"></div>

    <div class="sidebar-sticky">
  <div class="sidebar-about">
    
      <a class="no-hover" href="/" tabindex="-1">
        <img src="/assets/img/rowell_avatar.png" class="avatar" alt="Keiran Rowell" width="120" height="120" loading="lazy" />
      </a>
    
    <a class="sidebar-title" href="/"><h2 class="h1">Keiran Rowell</h2></a>
    
    
      <p class="">
        <table>
  <tbody>
    <tr>
      <td>Science</td>
      <td>Education</td>
      <td>Computing</td>
    </tr>
  </tbody>
</table>

      </p>
    
  </div>

  <nav class="sidebar-nav heading" role="navigation">
    <span class="sr-only">Navigation:</span>
<ul>
  
    
      
      <li>
        <a
          id="_drawer--opened"
          href="/about/"
          class="sidebar-nav-item "
          
        >
          About
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/projects/"
          class="sidebar-nav-item "
          
        >
          Projects
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/resume/"
          class="sidebar-nav-item "
          
        >
          R√©sum√©/CV
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/teaching/"
          class="sidebar-nav-item "
          
        >
          Teaching
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/posts/"
          class="sidebar-nav-item "
          
        >
          Posts
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/talks/"
          class="sidebar-nav-item "
          
        >
          Talks
        </a>
      </li>
    
  
</ul>

  </nav>

  
  <div class="sidebar-social">
    <span class="sr-only">Social:</span>
<ul>
  
    
      



  

  
  
  
  

  

  

  <li>
    <a href="mailto:keiran.rowell@gmail.com" title="Email" class="no-mark-external">
      <span class="icon-mail"></span>
      <span class="sr-only">Email</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://scholar.google.com/citations?user=tpcUE5IAAAAJ" title="Google Scholar" class="no-mark-external">
      <span class="icon-book"></span>
      <span class="sr-only">Google Scholar</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://github.com/keiran-rowell" title="GitHub" class="no-mark-external">
      <span class="icon-github"></span>
      <span class="sr-only">GitHub</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://mastodon.social/@keiran_rowell" title="Mastodon" class="no-mark-external">
      <span class="icon-mastodon"></span>
      <span class="sr-only">Mastodon</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://www.linkedin.com/in/keiran-rowell" title="LinkedIn" class="no-mark-external">
      <span class="icon-linkedin2"></span>
      <span class="sr-only">LinkedIn</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://www.analytical.unsw.edu.au/facilities/sbf" title="Faculty" class="no-mark-external">
      <span class="icon-library"></span>
      <span class="sr-only">Faculty</span>
    </a>
  </li>


    
  
</ul>

  </div>
</div>
  </header>
</hy-drawer>
<hr class="sr-only" hidden />

</hy-push-state>


  <!--[if gt IE 10]><!---->
  <script nomodule>(()=>{var t,n=document.createElement("script");!("noModule"in n)&&"onbeforeload"in n&&(t=!1,document.addEventListener("beforeload",function(e){if(e.target===n)t=!0;else if(!e.target.hasAttribute("nomodule")||!t)return;e.preventDefault()},!0),n.type="module",n.src=".",document.head.appendChild(n),n.remove())})();
</script>
  <script src="/assets/js/hydejack-9.2.1.js" type="module"></script>
  <script src="/assets/js/LEGACY-hydejack-9.2.1.js" nomodule defer></script>
  

  

<!--<![endif]-->
  <!--
Code for integrating CloudFlare's email protection with Hydejack's single page app loading.
-->
<script>
  document.getElementById('_pushState').addEventListener('hy-push-state-after', function (e) {
    function e(e){
      (console.error?console.error:console.log).call(console,e)
    }

    function t(e){
      return l.innerHTML='<a href="'+e.replace(/"/g,"&quot;")+'"></a>',l.childNodes[0].getAttribute("href")
    }

    function r(e,t){
      var r=e.substr(t,2);return parseInt(r,16)
    }

    function n(e,n){
      for(var o="",c=r(e,n),a=n+2;a<e.length;a+=2){
        var l=r(e,a)^c;
        o+=String.fromCharCode(l)
      }
      return t(o)
    }

    var o="/cdn-cgi/l/email-protection#",
        c=".__cf_email__",
        a="data-cfemail",
        l=document.createElement("div");

    !function(){
      for(var t=document.getElementsByTagName("a"),r=0;r<t.length;r++)
        try{
          var c=t[r],a=c.href.indexOf(o);
          a>-1&&(c.href="mailto:"+n(c.href,a+o.length))
        }catch(t){
          e(t)
        }
    }(),
    function(){
      for(var t=document.querySelectorAll(c),r=0;r<t.length;r++)
        try{
          var o=t[r],l=n(o.getAttribute(a),0),i=document.createTextNode(l);
          o.parentNode.replaceChild(i,o)
        }catch(t){
          e(t)
        }
    }()
  });
</script>





<div hidden>
  
  <h2 class="sr-only">Templates (for web app):</h2>

  <template id="_animation-template">
  <div class="animation-main fixed-top">
    <nav id="breadcrumbs" class="screen-only"><ul>
  
  
</ul></nav>
    <div class="content">
      <div class="page"></div>
    </div>
  </div>
</template>

  <template id="_loading-template">
  <div class="loading nav-btn fr">
    <span class="sr-only">Loading‚Ä¶</span>
    <span class="icon-cog"></span>
  </div>
</template>

  <template id="_error-template">
  <div class="page">
    <h1 class="page-title">Error</h1>
    
    
    <p class="lead">
      Sorry, an error occurred while loading <a class="this-link" href=""></a>.

    </p>
  </div>
</template>

  <template id="_permalink-template">
  <a href="#" class="permalink">
    <span class="sr-only">Permalink</span>
    <span class="content-hash"></span>
  </a>
</template>

  
    <template id="_dark-mode-template">
  <button id="_dark-mode" class="nav-btn no-hover" >
    <span class="sr-only">Dark Mode</span>
    <span class="icon-brightness-contrast"></span>
  </button>
</template>

  
</div>


</body>
</html>
